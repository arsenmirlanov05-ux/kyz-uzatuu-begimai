<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Begimai — Кыз узатуу</title>
  <meta name="description" content="Приглашение на Кыз узатуу: дата, место, программа, дресс-код и RSVP." />
  <meta property="og:title" content="Begimai — Кыз узатуу" />
  <meta property="og:description" content="Тёплый вечер в кругу родных и друзей. Присоединяйтесь!" />
  <meta name="color-scheme" content="light" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffffff; --fg:#1a1a1a; --muted:#6b6b6b;
      --accent:#7a1e2c; --accent-2:#a02a3d;
      --line:#ececec; --shadow:0 10px 30px rgba(122,30,44,.12);
      --reveal-dur:.7s; --reveal-ease:cubic-bezier(.22,1,.36,1); --reveal-distance:24px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; color:var(--fg); background:var(--bg); font-family:Inter,system-ui,Arial,sans-serif}
    a{color:inherit; text-decoration:none}
    img{max-width:100%; display:block}

    /* Hero */
    .hero{
      --header-img:url('header.jpeg');
      min-height:100svh; position:relative; display:grid; place-items:end center;
      background:
        linear-gradient(180deg, rgba(255,255,255,0) 40%, rgba(255,255,255,.8) 70%, #fff 100%),
        linear-gradient(180deg, rgba(122,30,44,.35), rgba(122,30,44,.15) 40%, rgba(122,30,44,0) 70%),
        var(--header-img) center/cover no-repeat;
    }
    .panel{width:min(920px,100%); padding:28px 18px 42px; text-align:center}
    .eyebrow{letter-spacing:.18em; text-transform:uppercase; font-weight:700; color:var(--accent); font-size:13px}
    .title{font:700 clamp(28px,5.8vw,50px) 'Playfair Display',serif; margin:8px 0 6px}
    .subtitle{color:var(--muted)}
    .meta{display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin:16px 0 18px}
    .badge{border:1px solid var(--line); padding:10px 14px; border-radius:999px; background:#fff; box-shadow:var(--shadow); font-weight:600}
    .scroll-btn{margin:10px auto 0; display:inline-flex; align-items:center; gap:10px; padding:14px 18px; border-radius:999px; border:1px solid var(--accent); color:#fff; background:linear-gradient(180deg,var(--accent),var(--accent-2)); box-shadow:0 10px 20px rgba(122,30,44,.25); cursor:pointer}
    .scroll-btn:hover{transform:translateY(-1px)}

    /* Sections */
    .section{max-width:1040px; margin:0 auto; padding:32px 16px; text-align:center}
    .h2{font:700 clamp(22px,4.4vw,30px) 'Playfair Display',serif; margin:0 0 14px}
    .lead{color:var(--muted); margin:6px 0 0}
    .card{background:#fff; border:1px solid var(--line); border-radius:18px; padding:18px; box-shadow:var(--shadow)}
    .sp{height:8px}

    /* Countdown */
    .countdown{display:grid; grid-template-columns:repeat(4,1fr); gap:16px; max-width:640px; margin:16px auto 0}
    .cd{padding:10px 0}
    .cd b{display:block; font:700 clamp(28px,6vw,48px) 'Playfair Display',serif; color:var(--accent)}
    .cd span{text-transform:uppercase; letter-spacing:.08em; color:var(--accent); font-weight:600; font-size:11px; opacity:.88}

    /* Calendar */
    .calendar{--accent:#7a1e2c;}
    .cal{display:grid; gap:12px; padding:20px 12px}
    .cal-head{display:flex; justify-content:center; align-items:center; gap:10px}
    .month{font:700 clamp(20px,5vw,28px) 'Playfair Display',serif; letter-spacing:.08em; text-transform:uppercase; color:#2a2a2a}
    .grid{display:grid; grid-template-columns:repeat(7,minmax(28px,1fr)); gap:12px; max-width:360px; margin:0 auto; justify-items:center}
    .dow,.day{font:600 clamp(16px,4.8vw,20px) 'Playfair Display',serif; color:#2a2a2a}
    .dow{text-transform:uppercase; letter-spacing:.06em; font-size:12px; color:var(--muted)}
    .day.heart{position:relative; color:var(--accent); font-weight:700}
    .day.heart::after{
      content:""; position:absolute; top:-8px; right:-10px; width:18px; height:18px;
      background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 29"><path fill="%237a1e2c" d="M23.6 0c-2.6 0-4.9 1.2-6.6 3.1C15.3 1.2 13 0 10.4 0 4.7 0 0 4.7 0 10.4c0 11.3 16 18.1 16 18.1s16-6.8 16-18.1C32 4.7 27.3 0 21.6 0z"/></svg>') center/contain no-repeat;
      transform-origin:center; animation:heartPulse 1.6s ease-in-out infinite;
    }
    @keyframes heartPulse{0%{transform:scale(1)}50%{transform:scale(1.16)}100%{transform:scale(1)}}

    /* === Расписание: круг-часы с фото === */
    .clock{ --size:min(520px, 88vw); width:var(--size); aspect-ratio:1/1; margin:10px auto 0; position:relative; display:grid; place-items:center; }
    .photo-frame{ position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:62%; aspect-ratio:1/1; border-radius:50%; overflow:hidden; background:#f4f4f4; border:4px solid #fff; box-shadow:var(--shadow); z-index:1; }
    .photo-frame .ph{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; opacity:0; transition:opacity .6s ease }
    .photo-frame .ph.show{ opacity:1 }
    .clock svg{ width:100%; height:100%; z-index:0 }
    .ring-base{ fill:none; stroke:#e9e9e9; stroke-width:2 }
    .runner{ transition:transform .75s ease; z-index:2 }
    .runner circle{ r:6; fill:var(--accent) }
    .mark{ position:absolute; transform:translate(-50%,-50%); text-align:center; width:max(120px,28%); opacity:.05; transition:opacity .4s ease .05s, transform .4s ease .05s; z-index:3 }
    .mark.on{ opacity:1; transform:translate(-50%,-50%) scale(1.02) }
    .badge-time{ display:inline-block; padding:4px 10px; border-radius:999px; background:#fff; color:var(--accent); font-weight:700; box-shadow:0 0 0 6px #fff; margin-bottom:6px; white-space:nowrap; }
    .mark .txt{ font-size:14px; color:var(--fg) }
    @media (max-width:600px){ .mark .txt{font-size:13px} }

    /* Точка-бегунок поверх всего */
    .runner-dot{
      position:absolute; left:0; top:0;
      width:14px; height:14px; border-radius:999px;
      background:var(--accent);
      box-shadow:0 0 0 4px #fff, 0 6px 18px rgba(122,30,44,.35);
      transform:translate(-50%,-50%);
      z-index:5; pointer-events:none;
    }

    /* Marquee */
    .marquee{position:relative; overflow:hidden; margin-top:10px}
    .marquee .track{display:flex; gap:12px; width:max-content; animation:marquee var(--marquee-dur,40s) linear infinite}
    .marquee .slide{position:relative; flex:0 0 auto; width:min(75vw,420px); height:400px; border-radius:16px; border:1px solid var(--line); overflow:hidden; background:#f6f6f6; box-shadow:var(--shadow)}
    .marquee .slide img{width:100%; height:100%; object-fit:cover; display:block}
    .marquee:hover .track{animation-play-state:paused}
    .marquee::before,.marquee::after{content:""; position:absolute; top:0; bottom:0; width:40px; pointer-events:none; background:linear-gradient(to right, rgba(122,30,44,.264), rgba(122,30,44,0))}
    .marquee::after{right:0; transform:scaleX(-1)}
    .marquee::before{left:0}
    @keyframes marquee{from{transform:translateX(0)} to{transform:translateX(-50%)}}

    .cap{position:absolute; left:0; right:0; bottom:0; padding:10px 12px; color:#fff; font-weight:600; font-size:14px; background:linear-gradient(0deg, rgba(0,0,0,.45), rgba(0,0,0,0)); text-shadow:0 2px 8px rgba(0,0,0,.35)}

    .owners{font:700 clamp(26px,6vw,40px) 'Playfair Display',serif; color:var(--accent)}
    .address .link{display:inline-flex; align-items:center; gap:8px; padding:12px 14px; border:1px solid var(--accent); border-radius:12px; margin:12px auto 0}
    .address .link:hover{background:#faf6f7}
    footer{padding:28px 16px; color:var(--muted); text-align:center}

    /* ===== ЛОКАЦИЯ ===== */
    .section.location{margin-top:clamp(80px,10vw,150px); text-align:center}
    .loc-title{color:var(--accent); text-transform:uppercase; letter-spacing:.14em; margin:0 0 40px}
    .loc-card{max-width:980px; margin:0 auto; padding:0; background:transparent; border:0; box-shadow:none; display:grid; place-items:center; text-align:center}
    .loc-venue{font:700 clamp(20px,4vw,26px) 'Playfair Display',serif; line-height:1.32; margin:0 0 12px}
    .loc-venue .accent{color:var(--accent)}
    .loc-address{color:var(--muted); font-size:clamp(15px,2.6vw,19px); line-height:1.5; margin:0 0 24px}
    .loc-photo{margin:0 auto 26px; border-radius:18px; overflow:hidden; aspect-ratio:16/9; background:#f3f3f3; max-width:min(980px,96%); display:block}
    .loc-photo img{width:100%; height:100%; object-fit:cover; object-position:center center}
    .loc-btn{display:inline-block; padding:16px 26px; border-radius:999px; background:var(--accent); color:#fff; font-weight:700; letter-spacing:.04em; box-shadow:0 10px 20px rgba(122,30,44,.18); transition:transform .12s ease, box-shadow .2s ease, background .2s ease}
    .loc-btn:hover{transform:translateY(-1px); background:var(--accent-2)}
    .loc-btn:active{transform:translateY(0); box-shadow:0 6px 12px rgba(122,30,44,.18)}

    /* Пожелание */
    .wish{max-width:900px; margin:40px auto 0; padding:0 16px; text-align:center}
    .wish-card{ background:#fff; border:1px solid var(--line); border-radius:22px; padding:34px 26px; box-shadow:0 24px 70px rgba(122,30,44,.10); }
    .wish-title{ font:700 clamp(22px,4.2vw,30px) 'Playfair Display',serif; color:var(--accent); margin:0 0 10px; }
    .wish-text{ font:italic 600 clamp(18px,3.6vw,22px) 'Playfair Display',serif; color:#2a2a2a; line-height:1.55; margin:0 auto; max-width:720px; }
    .wish-divider{ height:1px; width:140px; margin:16px auto; background:linear-gradient(90deg,transparent,var(--accent),transparent); opacity:.6; }
    .wish-sign{color:var(--muted); font-weight:600; letter-spacing:.02em}

    /* Фото-футер */
    .footer-hero{
      padding:0; margin-top:60px; min-height:100svh; position:relative;
      display:grid; place-items:center; text-align:center; overflow:hidden; color:#333;
    }
    .footer-img{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; }
    .footer-hero::after{
      content:""; position:absolute; inset:0;
      background:
        linear-gradient(0deg, rgba(255,255,255,0) 35%, rgba(255,255,255,.82) 70%, #fff 100%),
        linear-gradient(0deg, rgba(122,30,44,.35), rgba(122,30,44,.15) 40%, rgba(122,30,44,0) 70%);
    }
    .footer-hero .panel{ position:relative; z-index:1; width:min(920px,100%); padding:36px 18px 44px }
    .footer-eyebrow{ letter-spacing:.18em; text-transform:uppercase; font-weight:700; font-size:13px; color:var(--accent); opacity:.95 }
    .footer-title{  font:700 clamp(28px,5.6vw,44px) 'Playfair Display',serif; margin:10px 0 6px }
    .footer-names{  font:700 clamp(30px,6.4vw,50px) 'Playfair Display',serif; color:var(--accent); margin-top:8px }
    .legal{ position:relative; z-index:1; text-align:center; color:var(--muted); padding:16px }
    @media (max-width: 640px){ .footer-hero{ margin-top:40px; } }

    /* ================== SCROLL-REVEAL ================== */
    .reveal{ opacity:0; transform:translateY(var(--reveal-distance)); filter:blur(6px);
      transition: opacity var(--reveal-dur) var(--reveal-ease),
                 transform var(--reveal-dur) var(--reveal-ease),
                 filter calc(var(--reveal-dur)*.8) var(--reveal-ease); will-change:transform,opacity,filter; }
    .reveal.in{ opacity:1; transform:none; filter:blur(0) }
    .reveal.left{  transform:translateX(calc(var(--reveal-distance)*-1)) }
    .reveal.right{ transform:translateX(var(--reveal-distance)) }
    .reveal.scale{ transform:scale(.96) }
    .stagger > *{ transition-delay:calc(var(--i,0)*90ms) }
    @media (prefers-reduced-motion: reduce){
      .reveal,.reveal.in{ opacity:1; transform:none; filter:none; transition:none }
    }

    /* Кнопка музыки – сверху справа */
    .bgm-toggle{
      position:fixed;
      top:calc(16px + 50px + env(safe-area-inset-top, 0px));
      right:calc(16px + 25px + env(safe-area-inset-right, 0px));
      z-index:9999;
      width:56px; height:56px; border-radius:999px;
      display:grid; place-items:center; cursor:pointer;
      border:1px solid #a02a3d; background:linear-gradient(180deg,#7a1e2c,#a02a3d);
      color:#fff; font-weight:700; font-size:16px;
      box-shadow:0 10px 20px rgba(122,30,44,.25);
      -webkit-tap-highlight-color: transparent;
    }
    .bgm-toggle:hover{ transform:translateY(-1px) }
    .bgm-toggle.on{ outline:2px solid rgba(122,30,44,.25) }
    .bgm-toggle .icon{ line-height:1 }

    /* Смещение часов вправо на телефонах (+40px) */
    @media (max-width: 480px){
      #schedule .clock{ transform: translateX(40px); }
    }
  </style>
</head>
<body>
  <!-- ШАПКА -->
  <header class="hero" style="--header-img:url('header.jpeg')">
    <div class="panel">
      <div class="eyebrow">Кыз узатуу</div>
      <h1 class="title">Begimai</h1>
      <div class="subtitle">Тёплый семейный вечер в кругу близких</div>
      <div class="meta">
        <div class="badge">Дата: <b>3 октября</b></div>
        <div class="badge">Время: <b>17:00</b></div>
        <div class="badge"><b>Banket Hall Талас</b></div>
      </div>
      <button class="scroll-btn" id="scrollBtn" aria-label="Прокрутить вниз">↓ Пролистать</button>
    </div>
  </header>

  <section id="intro" class="section">
    <h2 class="h2">Приглашение</h2>
    <p class="lead">Мы с радостью приглашаем вас разделить этот значимый для нашей семьи день. Пожалуйста, присоединяйтесь к торжеству и тёплой атмосфере Кыз узатуу.</p>
    <div class="sp"></div>
    <div class="countdown" id="countdown" aria-label="Обратный отсчёт">
      <div class="cd"><b id="d">0</b><span>дней</span></div>
      <div class="cd"><b id="h">0</b><span>часов</span></div>
      <div class="cd"><b id="m">0</b><span>минут</span></div>
      <div class="cd"><b id="s">0</b><span>секунд</span></div>
    </div>
  </section>

  <!-- Календарь -->
  <section class="section calendar">
    <div class="cal">
      <div class="cal-head"><div class="month">ОКТЯБРЬ</div></div>
      <div style="color:var(--muted)">Праздничный день отмечен ❤</div>
      <div class="grid" id="calGrid"></div>
    </div>
  </section>

  <!-- РАСПИСАНИЕ 17:00–23:00 -->
  <section class="section" id="schedule">
    <h2 class="h2">Расписание торжества</h2>
    <div class="clock" id="clock">
      <div class="photo-frame" aria-label="Иллюстрация текущего этапа">
        <img id="phA" class="ph show" src="welcome.jpeg" alt="Сбор гостей" />
        <img id="phB" class="ph"      src="" alt="" />
      </div>
      <svg viewBox="0 0 200 200" aria-hidden="true">
        <circle class="ring-base" cx="100" cy="100" r="80"/>
        <g class="runner" id="runner" style="transform:translate(100px,20px)"><circle cx="0" cy="0"/></g>
      </svg>
      <div id="runnerDot" class="runner-dot" aria-hidden="true"></div>

      <div class="mark" data-hour="17"><div class="badge-time">17:00</div><div class="txt">Welcome & фото</div></div>
      <div class="mark" data-hour="18"><div class="badge-time">18:00</div><div class="txt">Открытие торжества</div></div>
      <div class="mark" data-hour="19"><div class="badge-time">19:00</div><div class="txt">Дастархан (обед)</div></div>
      <div class="mark" data-hour="20"><div class="badge-time">20:00</div><div class="txt">Поздравления и тосты</div></div>
      <div class="mark" data-hour="21"><div class="badge-time">21:00</div><div class="txt">Бата старших</div></div>
      <div class="mark" data-hour="22"><div class="badge-time">22:00</div><div class="txt">Проводы невесты</div></div>
      <div class="mark" data-hour="23"><div class="badge-time">23:00</div><div class="txt">Финал вечера</div></div>
    </div>
  </section>

  <!-- ЛОКАЦИЯ -->
  <section class="section location">
    <h2 class="h2 loc-title">ЛОКАЦИЯ</h2>
    <div class="loc-card">
      <div class="loc-text">
        <div class="loc-venue">Banket Hall <span class="accent">«Талас»</span></div>
        <div class="loc-address">Талас, Улица Чынгыза Айтматова, 246</div>
      </div>
      <div class="loc-photo"><img src="restik.jpg" alt="Зал ресторана «Талас»" loading="lazy"></div>
      <a class="loc-btn" href="https://go.2gis.com/M5tjs" target="_blank" rel="noopener">ПОСМОТРЕТЬ НА КАРТЕ</a>
    </div>
  </section>

  <!-- О БЕГИМАЙ -->
  <section class="section" id="bride">
    <h2 class="h2">Немного о Бегимай</h2>
    <p class="lead">Тёплое сердце, светлая улыбка и огромное желание делиться радостью с близкими.</p>

    <div class="marquee" id="brideMarquee" style="--marquee-dur: 36s" aria-label="О нашей невесте">
      <div class="track">
        <div class="slide">
          <img src="bema.jpg" alt="Портрет Бегимай, спокойный светлый фон"
               loading="eager" decoding="async" fetchpriority="high"
               onerror="this.src='welcome.jpeg'; this.onerror=null;">
          <div class="cap">Бегимай — нежность и сила в одном сердце</div>
        </div>
        <div class="slide">
          <img src="bema2.png" alt="Бегимай на прогулке в горах"
               onerror="this.src='welcome.jpeg'; this.onerror=null;">
          <div class="cap">Любит горы и долгие прогулки</div>
        </div>
        <div class="slide">
          <img src="bema3.jpg" alt="Бегимай с родителями"
               onerror="this.src='welcome.jpeg'; this.onerror=null;">
          <div class="cap">Благодарна родителям за поддержку и любовь</div>
        </div>
        <div class="slide">
          <img src="bema4.jpg" alt="Весёлое фото с друзьями"
               onerror="this.src='welcome.jpeg'; this.onerror=null;">
          <div class="cap">Друзья рядом — и сразу больше света</div>
        </div>
        <!-- клоны для бесшовности -->
        <div class="slide"><img src="bema.jpg"  alt="" onerror="this.src='welcome.jpeg'; this.onerror=null;"></div>
        <div class="slide"><img src="bema2.png" alt="" onerror="this.src='welcome.jpeg'; this.onerror=null;"></div>
        <div class="slide"><img src="bema3.jpg" alt="" onerror="this.src='welcome.jpeg'; this.onerror=null;"></div>
        <div class="slide"><img src="bema4.jpg" alt="" onerror="this.src='welcome.jpeg'; this.onerror=null;"></div>
      </div>
    </div>
  </section>

  <!-- ПОЖЕЛАНИЕ -->
  <section class="section wish" id="wish">
    <div class="wish-card">
      <div class="wish-title">Пожелание для этого вечера</div>
      <p class="wish-text">
        Пусть наш вечер наполнится теплом и благословением, а в дом Бегимай вместе
        с вашими добрыми словами придут кут, береке и махаббат. Спасибо, что
        разделяете с нами эту радость и делаете день особенным.
      </p>
      <div class="wish-divider"></div>
      <div class="wish-sign">С любовью и уважением, Жакшыбек &amp; Салтанат</div>
    </div>
  </section>

  <!-- Фото-футер -->
  <footer class="footer-hero">
    <img class="footer-img" src="footer.jpeg" alt="" loading="lazy">
    <div class="panel">
      <div class="footer-eyebrow">С нетерпением вас ждём</div>
      <div class="footer-title">Будем рады разделить этот вечер с вами</div>
      <div class="footer-names">Жакшыбек &amp; Салтанат</div>
    </div>
    <div class="legal">© <span id="y"></span>. С любовью, семья.</div>
  </footer>

  <!-- Фоновая музыка -->
  <audio id="bgm" preload="auto" loop playsinline>
    <source src="lamour.mp3" type="audio/mpeg">
  </audio>
  <!-- Тоггл-кнопка -->
  <button class="bgm-toggle" id="bgmToggle" aria-pressed="false" aria-label="Включить музыку">
    <span class="icon">♫</span>
  </button>

<script>
const SCROLL_SPEED_PX_S = 120;
const SCHEDULE_STEP_MS   = 1200;
const SCHEDULE_PAUSE_MS  = 500;

const sleep = (ms, signal)=> new Promise((res, rej)=>{
  const t = setTimeout(res, ms);
  if (signal) signal.addEventListener('abort', ()=>{ clearTimeout(t); rej('aborted'); }, {once:true});
});

function scrollToYConstant({toY, speed=SCROLL_SPEED_PX_S, signal}){
  return new Promise(resolve=>{
    const html = document.documentElement;
    const prevBehavior = html.style.scrollBehavior;
    html.style.scrollBehavior = 'auto';

    const minY   = 0;
    const maxY   = Math.max(0, document.documentElement.scrollHeight - window.innerHeight);
    const target = Math.min(maxY, Math.max(minY, toY));
    let y  = window.scrollY || window.pageYOffset || 0;
    let t0 = performance.now();
    if (Math.abs(target - y) < 1) { html.style.scrollBehavior = prevBehavior; resolve(); return; }

    let raf;
    const step = (t)=>{
      if (signal?.aborted){ cancelAnimationFrame(raf); html.style.scrollBehavior = prevBehavior; return; }
      const dt = (t - t0) / 1000; t0 = t;
      const dir = target > y ? 1 : -1;
      y += dir * speed * dt;
      if ((dir>0 && y >= target) || (dir<0 && y <= target)) { y = target; window.scrollTo(0,y); html.style.scrollBehavior = prevBehavior; resolve(); return; }
      window.scrollTo(0,y);
      raf = requestAnimationFrame(step);
    };
    raf = requestAnimationFrame(step);
  });
}

/* Календарь */
(function(){
  const calGrid=document.getElementById('calGrid');
  if(!calGrid) return;
  ['Пн','Вт','Ср','Чт','Пт','Сб','Вс'].forEach(d=>{const el=document.createElement('div'); el.className='dow'; el.textContent=d; calGrid.appendChild(el);});
  const year=2025, month=9;
  const first=new Date(year,month,1).getDay(), mapDow=d=>d===0?7:d;
  for(let i=0;i<mapDow(first)-1;i++){const e=document.createElement('div'); e.className='day'; e.style.visibility='hidden'; calGrid.appendChild(e);}
  const last=new Date(year,month+1,0).getDate();
  for(let d=1; d<=last; d++){const e=document.createElement('div'); e.className='day'+(d===3?' heart':''); e.textContent=d; calGrid.appendChild(e);}
})();

/* Отсчёт до 17:00 */
(function(){
  const target = new Date('2025-10-03T17:00:00');
  const els = {d:document.getElementById('d'), h:document.getElementById('h'), m:document.getElementById('m'), s:document.getElementById('s')};
  if(!els.d) return;
  const tick=()=>{const now=new Date(); let diff=Math.max(0,target-now);
    els.s.textContent=Math.floor(diff/1000)%60;
    els.m.textContent=Math.floor(diff/1000/60)%60;
    els.h.textContent=Math.floor(diff/1000/60/60)%24;
    els.d.textContent=Math.floor(diff/1000/60/60/24);
    if(diff>0) requestAnimationFrame(()=>setTimeout(tick,1000));
  }; tick();
})();

/* Часы 17:00–23:00 */
const runSchedule = (()=> {
  const clock  = document.getElementById('clock');
  if(!clock) return async()=>{};
  const runnerSvg = document.getElementById('runner');
  const runnerDot = document.getElementById('runnerDot');
  const marks  = Array.from(clock.querySelectorAll('.mark'));
  const phA = document.getElementById('phA');
  const phB = document.getElementById('phB');

  const seq = [17,18,19,20,21,22,23];
  const PHOTOS = {
    17:{src:'welcome.jpeg', alt:'Сбор гостей'},
    18:{src:'start.jpeg',   alt:'Открытие торжества'},
    19:{src:'dinner.jpeg',  alt:'Дастархан (обед)'},
    20:{src:'dance.jpg',    alt:'Поздравления и тосты'},
    21:{src:'bata.jpg',     alt:'Бата старших'},
    22:{src:'goodbye.jpg',  alt:'Проводы невесты'},
    23:{src:'final.jpg',    alt:'Финал вечера'}
  };
  Object.values(PHOTOS).forEach(({src})=>{ const i=new Image(); i.src=src; });

  const cx=100, cy=100, r=80;
  const ang = h => ((h%12)*30 - 90) * Math.PI/180;
  function placeMarks(){
    marks.forEach(m=>{
      const h=+m.dataset.hour, a=ang(h);
      const rx=cx+(r+18)*Math.cos(a), ry=cy+(r+18)*Math.sin(a);
      m.style.left=(rx/200*100)+'%'; m.style.top=(ry/200*100)+'%';
    });
  }
  function moveRunner(hour){
    const a=ang(hour);
    const x=cx+r*Math.cos(a), y=cy+r*Math.sin(a);
    if (runnerDot){
      runnerDot.style.left = (x/200*100) + '%';
      runnerDot.style.top  = (y/200*100) + '%';
    } else if (runnerSvg){
      runnerSvg.style.transform=`translate(${x}px,${y}px)`;
    }
  }
  let useA=false;
  function swapPhoto(hour){
    const pic=PHOTOS[hour]; if(!pic) return;
    useA=!useA; const show=useA?phA:phB, hide=useA?phB:phA;
    show.src=pic.src; show.alt=pic.alt||'';
    requestAnimationFrame(()=>{ show.classList.add('show'); hide.classList.remove('show'); });
  }
  function reset(){
    marks.forEach(m=>m.classList.remove('on'));
    placeMarks();
    moveRunner(seq[0]);
    phA.classList.add('show'); phB.classList.remove('show');
    phA.src = PHOTOS[seq[0]].src; phA.alt = PHOTOS[seq[0]].alt||'';
  }
  reset(); addEventListener('resize', placeMarks);

  return async ({stepMs=SCHEDULE_STEP_MS, pauseMs=SCHEDULE_PAUSE_MS, signal}={})=>{
    reset();
    for (let i=0;i<seq.length;i++){
      if (signal?.aborted) throw 'aborted';
      const h = seq[i];
      moveRunner(h);
      const m = marks.find(mm=>+mm.dataset.hour===h);
      if (m) m.classList.add('on');
      swapPhoto(h);
      await sleep(stepMs, signal);
      if (i<seq.length-1) await sleep(pauseMs, signal);
    }
  };
})();

/* Автоскролл */
(function(){
  const btn      = document.getElementById('scrollBtn');
  const schedule = document.getElementById('schedule');
  if (!btn || !schedule) return;

  let journeyCtrl = null;
  let unbindUser  = ()=>{};

  const USER_CANCEL_EVENTS = ['wheel','touchstart','keydown','mousedown','pointerdown'];
  function bindUserCancel(){
    const handler = ()=> stopJourney('user');
    USER_CANCEL_EVENTS.forEach(ev=> addEventListener(ev, handler, {passive:true}));
    return ()=> USER_CANCEL_EVENTS.forEach(ev=> removeEventListener(ev, handler, {passive:true}));
  }

  function stopJourney(){
    if (journeyCtrl){ journeyCtrl.abort(); journeyCtrl = null; }
    unbindUser(); btn.removeAttribute('aria-busy');
  }

  async function startJourney(){
    if (journeyCtrl) { stopJourney(); return; }
    journeyCtrl = new AbortController();
    const signal = journeyCtrl.signal;
    unbindUser = bindUserCancel();
    btn.setAttribute('aria-busy','true');

    const bottomY = Math.max(0, document.documentElement.scrollHeight - window.innerHeight);
    const r = schedule.getBoundingClientRect();
    const scheduleCenterY = (window.scrollY||window.pageYOffset) + r.top + r.height/2 - window.innerHeight/2;

    try{
      await scrollToYConstant({toY: scheduleCenterY, signal});
      await runSchedule({signal});
      await scrollToYConstant({toY: bottomY, signal});
    }catch(_){} finally{ stopJourney(); }
  }

  btn.addEventListener('click', (e)=>{ e.preventDefault(); startJourney(); });

  const y = document.getElementById('y'); if (y) y.textContent = new Date().getFullYear();
})();

/* Scroll-reveal */
(function(){
  if (window.__revealInit) return;
  window.__revealInit = true;

  const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
  const io = new IntersectionObserver((entries)=>{
    for (const e of entries){
      if (e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target); }
    }
  }, { threshold: 0.12, rootMargin: '0px 0px -8% 0px' });

  function addReveal(selector, extra){
    document.querySelectorAll(selector).forEach(el=>{
      el.classList.add('reveal'); if (extra) el.classList.add(extra);
      if (reduce) el.classList.add('in'); else io.observe(el);
    });
  }
  function makeStagger(selector){
    document.querySelectorAll(selector).forEach(group=>{
      group.classList.add('stagger');
      Array.from(group.children).forEach((child,i)=>{
        child.style.setProperty('--i', i);
        child.classList.add('reveal');
        if (reduce) child.classList.add('in'); else io.observe(child);
      });
    });
  }

  addReveal('header .panel');
  makeStagger('header .meta');
  makeStagger('.countdown');
  addReveal('.section .h2');
  addReveal('.section .lead');
  addReveal('.calendar .cal');
  addReveal('#schedule .clock');
  addReveal('.marquee');
  addReveal('.loc-card .loc-photo','left');
  addReveal('.loc-card .loc-text','right');
  addReveal('.loc-btn');
  addReveal('.wish-card');
  addReveal('footer.footer-hero .panel');

  window.addEventListener('pageshow', (e)=>{
    if (e.persisted){
      requestAnimationFrame(()=>{ document.querySelectorAll('.reveal:not(.in)').forEach(el=>io.observe(el)); });
    }
  });
})();

/* Ручной старт часов при ручном скролле */
(function(){
  const clock = document.querySelector('#schedule .clock');
  if (!clock || typeof runSchedule !== 'function') return;

  const btn = document.getElementById('scrollBtn');
  const isAutoRunning = () => btn && btn.getAttribute('aria-busy') === 'true';

  let playing = false;
  let played  = false;

  async function startOnce(){
    if (played || playing || isAutoRunning()) return;
    playing = true;
    try{ await runSchedule(); played = true; }catch(_){}
    finally{ playing = false; }
  }

  const io = new IntersectionObserver((entries)=>{
    entries.forEach(e=>{
      if (e.isIntersecting && e.intersectionRatio >= 0.55){ startOnce(); }
    });
  }, { threshold:[0,0.25,0.5,0.75,1], rootMargin:'0px 0px -8% 0px' });
  io.observe(clock);

  ['wheel','touchstart','keydown'].forEach(ev=>{
    addEventListener(ev, ()=>{
      if (isAutoRunning()) return;
      const r = clock.getBoundingClientRect();
      const vh = innerHeight || document.documentElement.clientHeight;
      if (r.top < vh*0.5 && r.bottom > vh*0.5) startOnce();
    }, {passive:true});
  });

  addEventListener('pageshow', e=>{
    if (e.persisted){
      setTimeout(()=>{
        const r = clock.getBoundingClientRect();
        const vh = innerHeight || document.documentElement.clientHeight;
        if (!played && !isAutoRunning() && r.top < vh*0.55 && r.bottom > vh*0.55) startOnce();
      }, 0);
    }
  });
})();

/* Музыка */
(function(){
  const audio = document.getElementById('bgm');
  const btn   = document.getElementById('bgmToggle');
  if(!audio || !btn) return;

  audio.volume = 0.6;
  const saved = localStorage.getItem('bgmOn');
  let wantOn  = saved ? JSON.parse(saved) : true;

  function setBtn(on){
    btn.classList.toggle('on', on);
    btn.setAttribute('aria-pressed', on);
    btn.title = on ? 'Выключить музыку' : 'Включить музыку';
    btn.querySelector('.icon').textContent = on ? '🔊' : '♫';
  }
  setBtn(false);

  function fadeTo(volTarget=1, ms=300){
    const steps = 20, from = audio.volume, delta = (volTarget - from)/steps;
    let i=0; const t = setInterval(()=>{ i++; audio.volume = Math.min(1, Math.max(0, from + delta*i));
      if(i>=steps) clearInterval(t);
    }, ms/steps);
  }

  async function play(unmute=false){
    try{
      if (unmute) audio.muted = false;
      await audio.play();
      setBtn(true);
      localStorage.setItem('bgmOn','true');
    }catch(e){ setBtn(false); }
  }
  function pause(){
    audio.pause();
    setBtn(false);
    localStorage.setItem('bgmOn','false');
  }

  btn.addEventListener('click', async ()=>{
    if (audio.paused){
      audio.muted = false;
      await play(true);
      fadeTo(0.6, 300);
    }else{
      fadeTo(0, 200);
      setTimeout(()=>pause(), 200);
    }
  });

  audio.muted = true;
  if (wantOn){
    audio.play().catch(()=>{});
    const unlock = async ()=>{
      off();
      audio.muted = false;
      try { await audio.play(); } catch(_){}
      setBtn(true); fadeTo(0.6, 300);
      localStorage.setItem('bgmOn','true');
    };
    const on  = (ev)=> window.addEventListener(ev, unlock, {once:true, passive:true});
    var off = ()=> ['click','touchend','pointerup','keydown'].forEach(ev=>window.removeEventListener(ev, unlock, {passive:true}));
    ['click','touchend','pointerup','keydown'].forEach(on);
  }

  /* <<< ВАЖНО: «Пролистать» всегда включает музыку >>> */
  const scrollBtn = document.getElementById('scrollBtn');
  if (scrollBtn){
    scrollBtn.addEventListener('click', async ()=>{
      audio.muted = false;
      try { await audio.play(); } catch(_){}
      setBtn(true);
      localStorage.setItem('bgmOn','true');
    });
  }
})();
</script>
</body>
</html>
